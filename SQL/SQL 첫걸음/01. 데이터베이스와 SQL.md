# 데이터베이스

- 데이터: 컴퓨터 안에 기록된 숫자
- 데이터베이스 : 데이터의 집합, 그러나 일반적인 의미로는 특정 데이터를 확인하고 싶을때 간단한게 찾아낼 수 있도록 정리된 형태
- 데이터베이스내의 데이터는 영구 보존되어야함, 즉 주기억장치가 아닌 하드디스크나 플래시메모리(SSD)등의 비휘발성 저장장치에 저장

## DB와 DBMS

- **DBMS**(Database Management System) : 데이터베이스를 효율적으로 관리하는 시스템
  - 생산성: 새로운 프로젝트를 할때 DBMS의 기본적인 데이터 검색, 추가, 삭제, 갱신을 새로 구축할 필요가 없다
  - 기능성: DB를 다루는 많은 기술을 제공, 복수 유저의 요청 응답, 대용랴의 데이터를 저장하고 고속으로 검색, 유지 보수
  - 신뢰성: 많은 요청에 대응할수 있도록 만들어졌다. 컴퓨터를 여러대 두고, 소프트웨어를 통해 확장성(Scalability)과 부하 분산(Load balancing)을 구현. 클러스터 구성 또는 스케일 아웃이라 부른다

## 관계형 데이터베이스를 조작하는 언어 SQL

- SQL은 데이터베이스중 RDBMS를 조작할때 사용
- IBM이 개발한 SEQUEL이라는 관계형 데이터베이스 조작용 언어를 기반으로 만들어짐
- ISO에서 표준화가 진행되어 C나 JAVA처럼 표준언어이다
- SQL의 종류
  - DML(Data Manipulation Launguage) : 데이터 조작
    - 데이터베이스에 새롭게 추가,삭제,갱신등 데이터 조작에 사용
    - SQL의 가장 기본 SET
  - DDL(Data Definition Launguage) : 데이터 정의
    - 데이터베이스는 데이터베이스 객체라는 데이터 그릇을 이용하여 데이터를 관리
    - DDL은 데이터베이스 객체를 만들거나 삭제하는 명령어
  - DCL(Data Control Language) : 데이터베이스 제어
    - 데이터를 제어하는 명령어
    - 트랜잭션을 제어하거나 데이터 접근권한을 제어하는 명령이 포함

# 데이터베이스의 종류

- 계층형 데이터베이스
  - 역사가 오래된 DMBS, 폴더와 파일 등의 계층 구조로 데이터를 저장하는 방식
  - 하드디스크나 DVD 파일 시스템
- 관계형 데이터베이스
  - 관계형 대수(relation algebra)라는 것에 착안하여 고안하 데이터베이스
  - 행과 열을 사용해 표 형식으로 데이터를 저장하는 데이터베이스
  - 표형식의 2차원 데이터를 다룬다
- 객체지향 데이터베이스
  - 객체(object) 그대로 데이터베이스의 데이터로 저장하는것이 목적인 데이터베이스
- XML 데이터 베이스
  - 태그 형태로 마크업 문서를 작성할수 있는 XML 형식으로 기록된 데이터를 저장하는 데이터 베이스
  - XQuery라는 전용 명령어 사용
- key - value 스토어 (KVS)
  - 키와 그에 대응하는 값(밸류)라는 단순한 형태의 데이터를 저장하는 데이터베이스
  - 키-밸류 조합은 연상배열(associative array)나 해시 테이블에서 자주 볼수 있다
  - **NoSQL**(Not only SQL)이라는 슬로건에서 탄생한 데이터베이스로 **열 지향 데이터베이스**라고 불림

## RDBMS 사용시스템

- 일반적인 인프라는 인터넷의 웹 시스템
- 하드웨어의 진화로 단말의 고성능화 지금은 개인 PC, 휴대폰에도 DBMS 내장
- 안드로이드는 SQLite가 표준으로 기본 내장, 경량화해서 임베디드 시스템에 자주 쓰이는 RDBMS

## 데이터베이스 제품

- Oracle : 역사가 깊고 가장 많이 쓰여서 사실상 표준
- DB2 : IBM이 개발, IBM 컴퓨터만 사용하여 점유율을 잃음
- SQL Server : 마이크로소프트가 개발한 RDBMS, 윈도우 플랫폼에서만 동작
- PostgerSQL : 오픈소스, 캘리포니아 대학 버클리 대학에서 탄생
- MySQL : 오픈소스, 최초에는 경량 DBMS였지만 현재에는 다양한 기능 제공
- SQLite : 임베디드용 경량 RDBMS

## 방언

- 각 데이터베이스 제품의 별도 기능 확장이 이루어지는 과정에서 비슷한 조작을 실행하더라도 서로 다른 명령어가 필요해짐 => 고유 방언 등장
- 예시) 키워드 생략
  - 오라클 SQL Server는 DELETE 뒤 FROM 생략 가능
- 방언은 환영받지 못하기 때문에, SQL-92 , SQL- 2003 같은 표준 SQL을 지정

# 데이터베이스 서버

- RDBMS는 복수의 클라이언트가 보내오는 요청에 응답할 수 있도록 클라이언트/서버 모델로 동작
- 일반적인 RDBMS는 네트워크상에 하나의 서버를 두고 독점함

## 클라이언트/서버 모델

- 사용자의 조작에 따라 요청하는 클라이언트
- 해당 요청을 받아 처리하는 서버
- 두개로 나눠 복수의 컴퓨터 상에서 하나의 모델을 구현하는 시스템
- 웹 시스템
  1. 브라우저가 사용자가 지정한 URL과 연결된 웹 서버에 요청을 보냄 (request)
  2. 페이지 열람을 요청시 HTML로 된 데이터를 클라이언트로 반환 (response)
- RDMBS의 클라이언트 서버 모델
  - 웹과 비슷하지만 **사용자 인증**이 필요
  - SQL 명령어를 보내면 이를 실행
  - 실행후 서버는 응답, 한번 접속하면 이를 재접속없이 계속 유지 가능
  - 사용 끝나면 데이터베이스와 접속 끊김

## 웹 애플리케이션의 구조

- 웹 애플리케이션은 웹 서버와 데이터베이스 서버의 조합으로 구축
- 브라우저가 클라이언트, 아파치나 IIS 같은 웹 소프트웨어가 서버 역할
- 클라이언트가 서버에게 요청하면 웹 서버는 클라이언트에게 응답
- 정적 HTML 웹이라면 웹서버만으로도 구현가능
- 웹 서버에서 동적으로 HTML을 생성하려면 제어용 프로그램 필요
- 웹 서버에서 **CGI**(Common Gateway Interface)같이 여러 방법을 이용해 동적 컨텐츠를 생성
- Perl, PHP, 루비 등의 스크립트 언어가 자주 사용
- 윈도우는 ASP.NET
- 자바와 Servlet같은 조합도 존재
- 데이터베이스에 접속하는것은 PHP나 루비등의 프로그래밍언어로 만들어진 프로그램
- 데이터베이스 서버를 사용하기 위해서는 먼저 데이터베이스 서버와의 접속이 성립되어야 한다
- 그 후 데이터베이스에 필요한 SQL명령 전달후 실행 결과가 클라이언트에게 되돌아간다
- DB서버 입장에서 볼떄 웹서버가 클라이언트 역할!

## CGI란? (Common Gateway Interface)

웹 서버에서 동적인 페이지를 보여 주기 위해 임의의 프로그램을 실행할 수 있도록 하는 기술 중 하나. 간혹 동적인 페이지는 다 CGI라고 생각하는 사람들이 있는데 CGI 말고도 이런 역할을 하는 기술은 여럿 있다. 단지 CGI가 맨 처음 나온 기술일 뿐.

원래 웹 서버는 서버에 저장되어 있는 고정된 문서를 보여 주는 역할을 했다. 하지만 웹 서버에서 정보를 찾거나 기록을 하려면 웹 서버를 고쳐서 그런 기능을 넣어야 하는데 버틸 수 없으니, 대신 웹 서버가 특정한 URL로 들어가면 요청을 원하는 프로그램에 적절히 넘겨 주는 기술이 필요해졌는데 CGI가 그런 역할을 한다.

1. (보통은 웹 브라우저 안에서, HTML의 폼을 통해) 요청이 웹 서버로 전달되면,
2. 웹 서버는 요청에 들어 있는 주소가 CGI 프로그램에 대응되는지 확인해서, 3.대응되면 그 프로그램을 실행해서 환경 변수와 표준 입력의 형태로 요청을 전달한다. 어떻게 전달되는지는 표준이 있다.
3. 웹 서버는 CGI 프로그램이 표준 출력으로 돌려 보낸 내용을 그대로 응답으로 돌려 준다.

이런 막강한 확장성을 가진 기술임에도 불구하고 CGI는 현재는 널리 쓰이지 않는데, 가장 큰 문제로 요청이 하나 들어 올 때마다 프로세스가 하나씩 실행된다는 것이 있다. 이는 특히 스크립트 언어에서 치명적이었는데 스크립트 언어에서는 보통 코드를 실행할 때마다 코드를 매번 해석해야 하기 때문이다. 물론 코드를 해석한 걸 캐싱하면 이 문제는 좀 나아지지만, 설령 C 언어 같은 언어로 미리 CGI 프로그램을 컴파일했다 하더라도 어지간한 환경에서는 프로세스 하나 실행하는데 몇 밀리초는 걸린다! 초당 수십건의 요청이 들어 오면 프로세스 실행하는 데만 시간을 다 소모할 것이다. 필요한 부분만 CGI로 만든다는 절충안을 쓴다 해도 요즘의 웹에는 동적인 것처럼 보이지 않아도 동적인 부분이 많기 때문에 적합하지 않다.

CGI를 대체하는 대부분의 기술들은 CGI의 이 단점을 해결하기 위해서 나온 게 보통이다. 몇 가지 예를 들면,

- 웹 서버가 직접 스크립트 언어를 해석하고 그 결과를 캐싱해서 빠르게 실행할 수 있도록 하는 경우가 있다. 특히 웹 서버 모듈로 확장 가능한 웹 서버에서 흔히 쓰이는데, 이 기술로 흥한 대표적인 언어가 바로 PHP이다(아파치 HTTP 서버의 mod_php 모듈). 근데 웃기게도 PHP 자체가 느려서 CGI를 안 쓰는 이득 중 상당수를 까먹는다. 그래도 CGI보다는 훨씬 빠르기 때문에 흥했다. 그리고 PHP 8에 JIT 컴파일이 도입된 2021년 기준으로는 느리다는 것도 옛날 이야기가 되었다.

- CGI 프로그램이 한 요청만 처리하고 종료되는 게 아니라 요청을 계속 처리할 수 있도록 CGI를 개량한 경우가 있다. 이 중 언어와 상관 없는 기술로는 FastCGI와 이의 개량판 SCGI가 대표적이며, 내부적으로 이런 식으로 돌게 만들어진 언어별 솔루션들도 아주 많다. 대표적으로 PHP를 윈도우에서 IIS로 돌리거나 리눅스에서 NGINX로 돌릴 경우 FastCGI 모듈을 이용해서 돌린다.

- 그냥 원하는 언어로 웹 앱 서버를 짠다! 이 경우 해당 프로그램은 항상 실행되어 있고, 웹 서버는 그 내부 서버를 중개하는 역할만 하게 된다. 이 쯤 되면 웹 서버의 존재 의의가 없어질 것 같지만, 이러한 내부 웹 서버들은 전용 웹 서버들에 비해서 보안이나 설정 편의성 면에서 한계가 있게 마련이니 나쁜 건 아니다.

다만 임의의 프로그램을 웹 서버에서 실행할 수 있다는 이유 때문에 오늘날에도 CGI는 이런 저런 용도로 종종 쓰이며, 어지간한 웹 서버는 CGI를 다 지원한다고 해도 과언이 아니다.

## MYSQL 실습용 환경구축

- MYSQL 패키지를 PC에 인스톨하면 서버와 클라이언트 모두 사용가능
- MYSQL 서비스가 데이터베이스 서버가 되고, mysql 커맨드가 클라이언트가 된다
- PC한대로 클라이언트와 서버 모두 실행할수 있지만 네트워크 기능은 필요
- 클라이언트에서 서버에 접속할 필요가 있는데, 네트워크를 경유해서 PC의 서버로 되돌아오는 형태로 접속
- 이를 **루프 백 접속**이라고 한다 (127.0.0.1, 로컬호스트)

## 루프백 접속 원리

TCP/IP 모델에서 생성된 모든 메시지는 수신자의 IP주소를 포함

TCP/IP 모델(의 Ethernet)은 실제 네트워크 메시지를 보내기 전에 각 메시지를 검사하는데, 이때 127.0.0.1 같은 루프백 ip 주소를 특수한 ip 주소로 인식

그리고 루프백 ip 주소로 보내진 메시지는 외부 소스에서 도착한 것처럼 TCP/IP 모델(의 Transport Layer)로 다시 보내지게 됨

(즉, 자신이 송신한 메시지를 내부적 처리를 통해 외부에서 수신한것 처럼 보이게 됨)
