# 프록시

Member를 조회할때 Team도 꼭 조회해야할까요? => 비즈니스 로직에 따라 다름

1. 멤버정보와 소속 팀정보가 동시 표시 => 필요
2. 멤버정보만 표시 => 필요X

필요없는 경우에도 가져오는게 리소스가 크다 => 지연 로딩 사용

find() VS getReference()

find(): 실제 엔티티 객체 조회
getReference(): 데이터베이스 조회를 미루는 가짜 엔티티 조회

## 프록시란?

- 실제 클래스를 상속받아서 만들어짐
- 겉은 똑같지만 속이 비었다
- 사용하는 입장에서는 진짜인지, 프록시 객체인지 모름
- 프록시 객체는 실제 객체의 참조(target)을 보관
- 프록시 객체를 호출하면 프록시 객체는 실제 객체의 메소드 호출

## 프록시 객체의 초기화

```java
Member member = em.getReference(Member.class, "id");
member.getName();
```

0. 프록시 사용하여 객체 생성 (getReference)
1. getName()시 프록시에 객체정보가 없음을 알게됨
2. 영속성 컨텍스트에 초기화 요청을 하면
3. 영속성 컨텍스트는 DB조회후 값을 가져옴
4. 실제 Entity를 생성해서 돌려줌 그리고 target과 연결
5. target의 진짜 객체의 getName을 통해 요청을 해결
6. 이후는 있으므로 바로 5로 넘어감

## 프록시 특징

- 프록시는 처음 사용할때 한번만 초기화
- 프록시 객체를 초기화 할때, 프록시 객체가 실제 엔티티로 바뀌는게 아니고, 프록시 객체를 통해서 실제 엔티티에 접근 가능
- 프록시 객체는 원본 엔티티를 상속, 타입 체크 주의 (== 쓰지말고, instanceof로)
- 영속성 컨택스트에 이미 있으면, em.getReferece()를 통해 호출해도, 실제 엔티티 반환
- 영속성 컨텍스트의 도움을 받을수없는, 준 영속성 상태일때 프록시 초기화시 에러 발생
