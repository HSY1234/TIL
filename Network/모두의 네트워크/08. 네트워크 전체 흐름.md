# 네트워크 전체 흐름

- 컴퓨터 송신
  - 응용 계층
  - 전송 계층
  - 네트워크 계층
  - 데이터 링크 계층
  - 물리 계층
- 라우터
  - 네트워크 계층
  - 데이터 링크 계층
  - 물리 계층
- 스위치
  - 데이터 링크 계층
  - 물리 계층

# 상황

- 컴퓨터 A (192.168.1.10) - 스위치 A - 라우터 A (192.168.1.1)
- 라우터 A (172.16.0.1) - 라우터 B (172.16.0.2)
- 컴퓨터 B (192.168.10.5) - 스위치 B - 라우터 B (192.168.10.1)
- 컴퓨터 A에서 컴퓨터 B로 index.html 요청

# 컴퓨터의 데이터가 전기 신호로 변환 과정

- 웹브라우저에 URL을 입력했다고 가정해보자
- 3-way 핸드셰이크는 이미 완료되어 연결이 확립되었다고 가정
- 응용 계층
  - 웹브라우저에서 URL을 입력 캡슐화 시작
  - 웹서버에 있는 html 데이터를 얻기위해 HTTP 프로토콜 사용
  - HTTP 메세지 'GET / index.html HTTP/1.1 ~' 보낸다
  - 전송 계층으로 전달
- 전송 계층
  - **TCP 헤더**를 붙인다
  - TCP 헤더에 필요한 출발지 포트 번호& 목적지 포트 번호
  - 웹브라우저는 잘 알려진 포트가 아닌 포트중 무작위(3500이라 가정)
  - 목적지 포트는 HTTP이므로 80번 포트
  - TCP 헤더를 붙여 **세그먼트**완성
  - 네트워크 계층으로 전달
- 네트워크 계층
  - 세그먼트에 **IP 헤더**를 붙인다
  - 출발지 IP주소와 목적지 IP주소가 필요
  - 본인의 IP주소 (192.168.1.10)
  - 목적지의 IP주소(DNS로 알고 있다고 가정) (192.168.10.5)
  - **IP패킷** 완성후 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - **이더넷 헤더**를 붙인다
  - 출발지 MAC주소와 목적지 MAC주소가 필요
  - 출발지 MAC주소는 자신의 MAC주소
  - 목적지 MAC주소는 **보낼 라우터 A의 MAC 주소**
  - **트레일러** (FCS)를 붙여서 **이더넷 프레임** 완성
  - 물리계층으로 전달
- 물리 계층
  - 네트워크 카드에서 비트열 데이터 => 전기 신호로 변환되어 전송

# 스위치에서 데이터 전달과 처리

- 물리 계층
  - 스위치가 전기신호를 데이터로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 헤더의 목적지 MAC 주소를 보고 A라우터의 포트 결정
  - 물리 계층으로 전달
- 물리 계층
  - 데이터를 전기신호로 변환하여 전송

# 라우터에서 데이터 전달과 처리

## 라우터 A

- 물리 계층
  - 라우터가 전기신호를 데이터로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 프레임의 **목적지 MAC 주소**와 **자신의 MAC주소**를 비교
  - 주소가 같다면 이더넷 헤더와 트레일러를 분리 (역캡슐화)
  - 네트워크 계층에 전달
- 네트워크 계층
  - **라우팅 테이블**과 목적지 IP 주소를 비교
  - 라우팅 테이블에서 목적지 IP 주소의 경로를 알수있어서 **라우팅** 가능
  - 현재 출발지 IP주소(192.168.1.10 사설IP)를 외부 IP주소(WAN측 172.16.0.1)로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 헤더를 붙임
  - 목적지 주소 = 라우터 B의 MAC주소
  - 출발지 주소 = 라우터 A의 MAC주소
  - 트레일러를 붙임
  - 물리 계층으로 전달
- 물리 계층
  - 전기신호로 변환하여 전송

## 라우터 B

- 물리 계층
  - 라우터가 전기신호를 데이터로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 프레임의 **목적지 MAC 주소**와 **자신의 MAC주소**를 비교
  - 주소가 같다면 이더넷 헤더와 트레일러를 분리 (역캡슐화)
  - 네트워크 계층에 전달
- 네트워크 계층
  - **라우팅 테이블**과 목적지 IP 주소를 비교
  - 라우팅 테이블에서 목적지 IP 주소의 경로를 알수있어서 **라우팅** 가능
  - 현재 출발지 IP주소(WAN측 172.16.0.1)를 라우터 IP주소(LAN측 192.168.10.1)로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 헤더를 붙임
  - 목적지 주소 = 웹서버의 MAC주소
  - 출발지 주소 = 라우터 B의 MAC주소
  - 트레일러를 붙임
  - 물리 계층으로 전달
- 물리 계층
  - 전기신호로 변환하여 전송

# 스위치에서 전달 과정

- 물리 계층
  - 스위치가 전기신호를 데이터로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 헤더의 목적지 MAC 주소 보고 해당 포트로 보내줌
  - 물리 계층으로 전달
- 물리 계층
  - 데이터를 전기신호로 변환하여 전송

# 웹 서버에서의 데이터 전달과 처리

- 물리계층
  - 전기신호가 데이터로 변경
  - 데이터 링크 계층으로 전달
- 데이터 링크 계층
  - 이더넷 프레임의 목적지 MAC주소와 자신의 MAC 주소 비교
  - 주소가 같으면 헤더 트레일러 분리후 네트워크 계층에 전달
- 네트워크 계층
  - 목적지 IP주소와 웹서버의 IP주소 비교
  - 같으면 IP헤더 분리후 전송계층 전달
- 전송 계층
  - 목적지 포트번호를 확인하고 어떤 애플리케이션으로 전달해야햐는지 판단
  - TCP헤더 분리후 응용계층의 해당 애플리케이션으로 전달
- 응용 계층
  - 웹서버 프로그램이 index.html을 보내달라는 HTTP 요구를 확인
