# 네트워크 계층

- **세그먼트 간**에서의 **데이터 송수신**을 하는것이 3계층 (**인터넷 작업**)
- 인터넷작업을 통해 **떨어진 위치에 있는 컴퓨터끼리 데이터 통신이 가능**하게 된다
- **인터넷 작업**: 고유명사 INTERNET(우리가 흔히 말하는 The Net)이 아닌, 네트워크간의 송수신을 **internetwork**(internet 소문자로 쓴다)라고 한다. 3계층은 그래서 인터넷 계층이 된다
- 3계층부터는 세그먼트 = 네트워크라고 한다, 즉 네트워트- 네트워크 간의 데이터 송수신을 담당
- 3계층의 네트워크의 의미는 **라우터와 라우터로 분배된 컴퓨터 그룹**
- **세그먼트** : 케이블 분배기 or 허브로 연결되는 범위, 신호가 닿는 범위
  - 멀티액세스 네트워크 (허브)
  - 포인트 투 포인트 네트워크 (컴퓨터-라우터, **라우터-라우터**)
- 1계층은 전기적인 케이블이 연결되어 있는 상대에 대한 신호 전달 (전기 신호 운반)
- 2계층은 신호 송수신이 가능한 상태에서 **세그먼트 내**에서 어떻게 데이터를 주고 받는지 (신호가 운반된다는 전제하에 데이터 송수신 순서 & 타이밍 & 충돌 관리)
- 네트워크 내의 컴퓨터끼리는 2계층에 의해 연결되어 있다 (멀티액세스, 포인트 투 포인트)
- 이더넷으로 허브나 스위치를 사용해서도 규모있는 네트워크를 만들수 있지만 문제가 여러가지 발생
  - 스위치로 충돌을 없앴지만 브로드 캐스트를 한다면?
    - 스위치는 브로드캐스트를 제어하지 않기 때문에, 도달하는 모든 범위에 컴퓨터가 수신해야한다
    - 즉 스위치로만 이룬 네트워크라면 한 컴퓨터가 브로드캐스팅할 경우, 네트워크 내의 모든 컴퓨터가 수신할때까지 브로드캐스팅해야한다
    - **라우터**를 넘어서는 브로드캐스트는 일어나지 않는다!
  - 2계층(스위치)는 인접기기끼리의 데이터 통신 (같은 세그먼트), 직접 바로 연결되어 있지 않은 기기까지 어떻게 전송? (= 인터넷작업)

# 인터넷 프로토콜(IP, Internet Protocol)

- **어드레싱**과 **라우팅**에 의해 인터넷 작업을 수행하기 위한 프로토콜
- 그중 TCP/IP 프로토콜군에서 사용되는 것을 **IP**라고 한다
- IP의 종류
  - IPv4
  - IPv6
- IPv4와 IPv6사이에는 호환성이 없다 (컴퓨터가 둘다 지원하면 따로 사용은 각각 가능)

## 어드레싱

- 2계층의 어드레스는 MAC 주소
- 3계층은 MAC주소를 사용할수 없다. MAC 주소는 장소를 특정할 수 없는 주소이다
- 세그먼트 내에서의 데이터 송수신은 MAC으로도 충분하지만(컴퓨터수가 적으니까), 3계층처럼 네트워크를 가로질러 다른 네트워크로 가려면 네트워크가 어디 있는지 알아야한다
- 3계층에서는 사용하는 주소를 **논리 주소**라고 부른다. 논리 주소는 어디에 있는지와 같은 위치 정보를 알려준다
- 2계층에서 사용되는 주소는 **물리 주소**라고 한다.
- 컴퓨터를 찾기위해서는 **어느 네트워크에 있는 어느 컴퓨터**라는 위치 정보가 필요하다
  - 어느 네트워크
  - 어느 컴퓨터

## 라우팅(routing)

- **경로 선택** : 수신처까지 어떤 경로로 갈지를 결정 = 어느 네트워크를 경유해서 갈까?
- 경유 네트워크를 결정하는것이 라우팅이고, 이는 **라우터**에서 결정한다

## IP 헤더

- IP 헤더는 20바이트 + 옵션의크기 이다
- IP의 PDU는 **IP 데이터그램** or **IP 패킷**이라 부른다
- IP 데이터 그램 = IP헤더 + 페이로드(4계층)
- IP 헤더의 구조
  - 버전 (version) | 4bit : IP의 버전
  - 헤더 길이 (header length) | 4bit: IP 헤더의 길이
  - 서비스 타입 (service type) | 8bit : 패킷의 우선도/중요도
  - 전체 데이터 길이 (total length) | 16bit : IP헤더와 페이로드를 합친 길이
  - ID (identification) | 16bit : 데이터그램의 식별번호
  - 플래그 (flags) | 3bit : 데이터그램을 분할했는지 아닌지 판별
  - 플래그먼트 오프셋 | 13bit (fragement offset) : 데이터그램을 분할한 경우 본래대로 되돌릴때 사용
  - TTL (Time To Live) | 8bit : 패킷의 생존시간
  - 프로토콜 (protocol) | 8bit : 상위 프로토콜 지정
  - 헤더 체크섬 (header checksum) | 16bit : IP 헤더의 에러 체크용
  - 송신처 IP (source IP address) | 32bit : 송신처의 논리 주소
  - 수신처 IP (destination IP address) | 32bit : 수신처의 논리 주소
  - 옵션 | n bit : 특별한 설정을 사용할때, 없다면 없어도 된다

# IP주소

- 어드레싱을 담당
- IP주소는 **네트워크 관리자가 컴퓨터에 할당**
- IP주소는 계층형 주소이다
- MAC주소는 벤더코드와 벤더할당코드의 조합이라서 사용하는 쪽에서는 변경이 불가능 (인터페이스에 고정)
- 논리주소인 IP주소는 네트워크 관리자의 필요에 따라 자유롭게 변경가능
- IP주소는 **네트워크에 접속 할때마다 붙인다**, 즉 소속된 네트워크가 바뀌면 논리주소도 바뀐다
- 논리주소의 종류
  - 유니캐스트 주소: 네트워크를 표시하는 번호는 접속되어 있는 모든 네트워크에서 유일
  - 멀티캐스트 주소
  - 브로드캐스트 주소 (IPv6는 애니캐스트)
- 네트워크 번호는 접속되어 있는 모든 네트워크에서 유일 (다른 네트워크라면 중복 가능)
- 컴퓨터 번호는 네트워크 내에서 유일
- IPv4주소는 **32bit**이다. 옥텟단위로 점을 찍어 표현
- 4개의 옥텟으로 **네트워크 번호**의 **컴퓨터 번호**를 나타낸다
- 클래스에 따라 32비트중 네트워크번호 와 컴퓨터 번호가 정해진다

## IP주소의 클래스

- IP주소의 네트워크 번호와 컴퓨터 번호를 구별하기 위한 방법
- **ICANN**이라는 조직에서 실제로 번호를 사용해 할당(대출)
- 클래스는 A~E의 5개로 나뉘어져있다 (**클래스풀 어드레싱**)
- 클래스의 종류
  - A클래스 : 대규모 네트워크 주소(0xxxxxx)
  - B클래스 : 중형 네트워크 주소(10xxxxxx)
  - C클래스 : 소규모 네트워크 주소(110xxxxx)
  - D클래스 : 멀티캐스트 주소 (1110xxxxx)
  - E클래스 : 연구 및 특수용도 주소 (1111xxxxx)
- 일반 네트워크는 A~C 클래스를 사용
  - A 클래스 처음 8비트가 네트워크 ID, 24비트가 호스트 번호
  - B 클래스 처음 16비트가 네트워크 ID, 16비트가 호스트 번호
  - C 클래스 처음 24비트가 네트워크 ID, 8비트가 호스트 번호
- 호스트 주소는 **모두가 1인 경우 브로드캐스트용**, **모두가 0인 경우 네트워크 주소**로 사용하기 때문에 2개를 뺀다
- A클래스 (0으로 시작)
  - 첫 1옥텟 범위 : 1~127 (00000001 ~ 01111111)
  - 2~4 옥텟 범위 : 0~255
  - 최대 호스트 수 : 1677만 7214대 (256\*256\*256 -2)
  - 범위 : 1.0.0.0 ~ 127.255.255.255
- B클래스 (10으로 시작)
  - 첫 1옥텟 범위 : 128~191 (10000000 ~ 10111111)
  - 2~4 옥텟 범위 : 0~255
  - 최대 호스트 수 : 6만 5534대 (256\*256 -2)
  - 범위 : 128.0.0.0 ~ 191.255.255.255
- C클래스 (110으로 시작)
  - 첫 1옥텟 범위 : 192~223 (11000000 ~ 11011111)
  - 2~4 옥텟 범위 : 0~255
  - 최대 호스트 수 : 254개 (256 -2)
  - 범위 : 192.0.0.0 ~ 223.255.255.255
- 클래스가 높으면 많은 컴퓨터를 소유하는 네트워크가 될수 있다

## 호스트 번호

- 클래스로 결정된 네트워크 번호를 뺀 나머지는 컴퓨터 번호, **호스트 번호**이다
- 호스트 번호는 네트워크 관리자가 임의로 할당할수있다
- 네트워크 관리자가 사용할수 없는 두가지 호스트 번호
  - **네트워크 주소**: 호스트 번호의 비트가 모두 0, 네트워크 자체를 표시
  - **브로드캐스트 주소**: 호스트 번호의 비트가 모두 1, 전체가 수신하기 위한 주소

# 서브네팅(subnetting)

- 클래스 A는 16772214대의 호스트를 소유가능 => 모두 번호를 붙이는건 거의 불가능!
- **서브넷**(subnet) : 커다란 네트워크를 몇개의 작은 네트워크로 잘게 분할
- IP주소는 32비트로 고정되어 있으므로, 서브넷 번호를 추가하는것은 힘들다
- 호스트번호의 비트를 서브넷 번호와 호스트 번호로 분할해서 사용
- 원래 네트워크 할당 IP를 서브넷화 하는것을 **서브넷팅**이라고 한다
- 서브넷의 숫자를 크게 하면 각 서브넷의 호스트 수는 감소 (호스트 비트는 제한되어 있으므로)

## 서브넷 마스크

- 서브넷은 원래 IP주소에서 호스트 번호를 네트워크 관리자 마음대로 가져다 쓴것
- **서브넷은 그 네트워크 내부에서만 유효**
- 컴퓨터가 어느 네트워크에 소속되어 있는가? = IP주소의 어디까지가 네트워크의 주소인가?
- 클래스를 알면 어디까지 네트워크 번호인지는 알수있지만, 서브네팅은 판단 불가
- **서브넷 마스크**(Subnetmask) : 서브넷을 사용할때 어디까지가 서브넷 번호인지 표현하는 비트열
  - IP주소와 같은 32비트, 네트워크 번호+ 서브넷 번호까지 비트를 모두 1 호스트는 0으로 한다
  - 서브넷을 사용할때 서브넷 마스크는 IP주소와 동시에 세트로 표기해야한다
  - 즉 서브넷 마스크가 1인 비트부분까지가 네트어크 번호이다

# 클래스리스 어드레싱

- **클래스리스 어드레싱**(Classless Addressing) : 클래스라는 구분을 없앤 어드레싱
- 현대는 필요 IP의 수가 훨씬 많아져 클래스로 IP주소를 거의 할당하지 않음(클래스풀 어드레싱)
  - 특히 클래스는 A B C 호스트 개수 범위차이가 너무 많이 난다
- 클래스리스의 경우 클래스를 사용하지 않고 필요에 따라 비트수를 정한다
  - 예를 들어 네트워크 번호가 18비트이면, 호스트 비트가 14비트 약 16000개정도 호스트 사용
  - 호스트가 16000개 범위 안에 들어갈거 같으면 18비트를 선택한다
- **슈퍼넷**(Super Network) : 클래스를 사용하되, 같은 클래스 네트워크들을 여러개 묶어서 통합해 하나의 네트워크처럼 보이게 하는 방법
  - 예) C클래스 네트워크 32비트중 앞 21비트까지는 똑같고 뒤에 3비트는 다르게 8개의 C클래스를 묶어 하나처럼쓰면 호스트가 2048개가 제공되는 네트워크처럼 쓸수 있다
- 서브넷 마스크는 클래스풀 어드레싱에 서브네팅 쓰는용도로 클래스리스에서 사용불가
- **프리픽스 길이**(Prefix-Length) : 서브넷 마스크대신 클래스리스에서 네트워크번호의 길이를 나타내는 값, IP주소와 함께 쓴다
- 용도자체는 서브넷 마스크와 같다 (네트워크 번호는 1 호스트는 0)
- 예) IP주소 /21 = 21비트까지가 네트워크 번호다
