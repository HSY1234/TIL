# CPU 설계

## 클럭

- 컴퓨터 부품은 클럭 신호 단위로 움직인다
- CPU는 명령어 사이클이라는 정해진 흐름에 맞춰 명령어를 실행한다
- 클럭이 빠르면 일반적으로 성능이 좋음
- 클럭의 단위는 Hz, 1초에 몇번 클럭이 반복되는지
- 클럭 속도는 일정하지 않음, 필요한 순간에만 클럭속도를 올림
- 장기간 클럭을 올리면 발열과 CPU에 무리가 간다

## 코어 & 멀티 코어

- CPU는 명령어를 실행하는 부품 = 예전에는 CPU가 한개였음
- 현대에는 '명령어를 해석하는 부품'을 **코어**라고 부르고, CPU는 코어를 여러개 가진 부품으로 확장
- 이를 멀티코어 CPU, 멀티코어 프로세서라고 부른다
- 그러나 코어의 수와 연산처리 속도는 정비례하지 않는다
- 작업을 균등하게 분배하는건 불가능하기 때문
- 작업의 양이 적다면 코어가 많아도 의미가 없기 때문
- 핵심은 코어마다 처리할 명령어를 어떻게 분배하는냐

# 스레드 & 멀티 스레드

- **스레드(thread)**: 실행 흐름의 단위
- CPU에서 사용하는 스레드 ≠ 프로그래밍에서 사용하는 스레드, 의미적으로 구분해야함
- 스레드
  - 하드웨어적 스레드
  - 소프트웨어적 스레드

## 하드웨어적 스레드

- 하드웨어 스레드: 하나의 코어가 동시에 처리하는 명령어 단위
- 주로 CPU 입장에서 스레드라고하면 이에 해당
- 과거에는 CPU는 1코어 1스레드
- 현대에는 1코어로 여러개의 명령어를 동시에 실행할 수 있게 됨
- 2코어 4스레드 = 1코어가 2스레드씩 처리 가능 \* 2
- 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 **멀티스레드(multithread) 프로세서** or 멀티스레드 CPU라고 함
- 하이퍼스레딩(hyper-threading)은 인텔의 멀티스레드 기술중 한개의 명칭

## 소프트웨어적 스레드

- 소프트웨어적 스레드: 하나의 프로그램에서 독립적으로 실행되는 단위
- 운영체제에서 학습할때는 주로 이 의미로 사용
- 소프트웨어적 스레드를 이용하면 한 프로그램에서 동시에 여러 기능을 수행하는것처럼 보일수 있다.
- 예시) 워드프로세서 프로그램
  - 사용자로부터 입력 받은 내용을 화면에 보여주는 기능
  - 사용자가 입력한 내용이 맞춤법에 맞는지 검사
  - 사용자가 입력한 내용을 수시로 저장
- 1코어 1스레드 CPU 환경에서도 소프트웨어적 스레드 수십개 실행가능

## 멀티스레드 프로세서는 어떻게 1코어로 동시에 여러개의 스레드를 처리 할수 있는가?

- 여러 복잡한 기술들이 있지만, 핵심은 레지스터
- 하나의 코어로 여러 명령어를 동시에 처리하려면 PC, 스택포인터, MAR, MBR 같이 필요한 **레지스터 SET**을 여러개 가지고 있으면 된다
- 즉 ALU, 제어장치는 하나지만 레지스터 SET이 여러개라서 동시에 여러 상태를 기억하고 ALU가 여러 명령어 처리 가능
- 소프트웨어 입장에서는 하나의 하드웨어 스레드는 마치 한번에 하나의 명령어를 처리하는 CPU로 보임
- 즉, 2코어 4스레드 CPU는 소프트웨어 입장에서는 1코어 CPU가 4개 있는것과 같이 느껴짐
- 그래서 하드웨어 스레드를 **논리 프로세서(logical processor)**라고 부르기도 함 (윈도우 작업관리자에서 확인 가능)
